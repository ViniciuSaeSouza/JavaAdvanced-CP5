<!DOCTYPE html>
<html
  xmlns:th="http://www.thymeleaf.org"
  lang="pt-br"
  th:replace="~{layout :: layout(~{::title}, ~{::content})}"
>
  <head>
    <title th:text="${isEdit} ? 'Editar Estoque' : 'Novo Estoque'"></title>
  </head>
  <body>
    <div th:fragment="content">
      <div
        class="form-header mb-4 p-4 text-white position-relative overflow-hidden"
        style="
          background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
          border-radius: 20px;
        "
      >
        <div class="row align-items-center">
          <div class="col-lg-8">
            <h2 class="mb-2 fw-bold">
              <i class="bi bi-box-seam-fill me-3" th:if="${!isEdit}"></i>
              <i class="bi bi-gear-fill me-3" th:if="${isEdit}"></i>
              <span
                th:text="${isEdit} ? 'Editar Estoque' : 'Novo Estoque'"
              ></span>
            </h2>
            <p
              class="mb-0 opacity-90"
              th:text="${isEdit} ? 'Modifique as configurações do local de armazenamento' : 'Configure um novo local de armazenamento'"
            ></p>
          </div>
          <div class="col-lg-4 text-end">
            <a class="btn btn-light" th:href="@{/estoques}">
              <i class="bi bi-arrow-left me-2"></i>Voltar
            </a>
          </div>
        </div>
      </div>

      <div class="card form-card border-0 shadow-lg">
        <div class="card-body p-5">
          <form
            th:action="${formAction}"
            method="post"
            th:object="${estoque}"
            class="form-modern"
          >
            <div class="row g-4">

              <div class="col-md-8">
                <div class="form-floating">
                  <input
                    class="form-control form-control-modern"
                    th:field="*{localArmazenamento}"
                    id="localArmazenamento"
                    placeholder="Ex: Galpão A - Setor 1, Prateleira B - Andar 2"
                  />
                  <label for="localArmazenamento">
                    <i class="bi bi-geo-alt-fill me-2"></i>Local de
                    Armazenamento
                  </label>
                </div>
                <div class="form-text">
                  <i class="bi bi-info-circle me-1"></i>
                  Descreva detalhadamente onde ficará localizado este estoque
                </div>
                <div
                  class="form-error"
                  th:if="${#fields.hasErrors('localArmazenamento')}"
                  th:errors="*{localArmazenamento}"
                ></div>
              </div>


              <div class="col-md-4">
                <div class="form-floating">
                  <input
                    type="number"
                    min="1"
                    class="form-control form-control-modern"
                    th:field="*{capacidade}"
                    id="capacidade"
                    placeholder="100"
                  />
                  <label for="capacidade">
                    <i class="bi bi-speedometer2 me-2"></i>Capacidade Máxima
                  </label>
                </div>
                <div class="form-text">
                  <i class="bi bi-info-circle me-1"></i>
                  Número máximo de ferramentas
                </div>
                <div
                  class="form-error"
                  th:if="${#fields.hasErrors('capacidade')}"
                  th:errors="*{capacidade}"
                ></div>
              </div>


              <div th:if="${isEdit}" class="col-12">
                <div class="info-card card border-0 mt-4">
                  <div
                    class="card-header bg-gradient text-white text-center py-3"
                    style="
                      background: linear-gradient(135deg, #34495e, #2c3e50);
                      border-radius: 15px 15px 0 0;
                    "
                  >
                    <h5 class="mb-0 fw-bold">
                      <i class="bi bi-graph-up me-2"></i>Análise do Estoque
                    </h5>
                  </div>
                  <div
                    class="card-body p-4"
                    style="
                      background: rgba(248, 249, 250, 0.8);
                      border-radius: 0 0 15px 15px;
                    "
                  >
                    <div class="row g-4 text-center">
                      <div class="col-lg-3 col-md-6">
                        <div class="stat-item">
                          <i class="bi bi-tools stat-icon text-primary"></i>
                          <div
                            class="stat-number text-primary"
                            th:text="${estoqueInfo.quantidadeTotal}"
                          >
                            0
                          </div>
                          <div class="stat-label">Ferramentas Atuais</div>
                        </div>
                      </div>
                      <div class="col-lg-3 col-md-6">
                        <div class="stat-item">
                          <i class="bi bi-speedometer2 stat-icon text-info"></i>
                          <div
                            class="stat-number text-info"
                            th:text="${estoqueInfo.capacidade}"
                          >
                            0
                          </div>
                          <div class="stat-label">Capacidade Total</div>
                        </div>
                      </div>
                      <div class="col-lg-3 col-md-6">
                        <div class="stat-item">
                          <i class="bi bi-box stat-icon text-success"></i>
                          <div
                            class="stat-number text-success"
                            th:text="${estoqueInfo.capacidade - estoqueInfo.quantidadeTotal}"
                          >
                            0
                          </div>
                          <div class="stat-label">Espaços Livres</div>
                        </div>
                      </div>
                      <div class="col-lg-3 col-md-6">
                        <div class="stat-item">
                          <i class="bi bi-pie-chart stat-icon text-warning"></i>
                          <div
                            class="stat-number text-warning"
                            th:text="${#numbers.formatDecimal(estoqueInfo.quantidadeTotal * 100.0 / estoqueInfo.capacidade, 1, 1)} + '%'"
                          >
                            0%
                          </div>
                          <div class="stat-label">Taxa de Ocupação</div>
                        </div>
                      </div>
                    </div>


                    <div class="mt-4">
                      <div class="d-flex justify-content-between mb-2">
                        <span class="fw-bold">Ocupação do Estoque</span>
                        <span
                          th:text="${estoqueInfo.quantidadeTotal} + '/' + ${estoqueInfo.capacidade}"
                        ></span>
                      </div>
                      <div class="progress-modern" style="height: 15px">
                        <div
                          class="progress-bar-modern"
                          th:style="'width: ' + ${estoqueInfo.quantidadeTotal * 100.0 / estoqueInfo.capacidade} + '%;'"
                          th:classappend="${estoqueInfo.quantidadeTotal >= estoqueInfo.capacidade ? 'bg-danger-gradient' : (estoqueInfo.quantidadeTotal >= estoqueInfo.capacidade * 0.8 ? 'bg-warning-gradient' : 'bg-success-gradient')}"
                        ></div>
                      </div>
                    </div>


                    <div
                      th:if="${!#lists.isEmpty(estoqueInfo.ferramentas)}"
                      class="mt-4"
                    >
                      <h6 class="fw-bold mb-3">
                        <i class="bi bi-list-ul me-2"></i>Ferramentas neste
                        estoque:
                      </h6>
                      <div class="ferramentas-grid">
                        <span
                          th:each="ferramenta : ${estoqueInfo.ferramentas}"
                          class="badge ferramenta-badge bg-secondary me-2 mb-2"
                          th:text="${ferramenta.nome}"
                        ></span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>


              <div class="col-12 mt-5">
                <div class="d-flex gap-3 justify-content-end">
                  <a
                    class="btn btn-outline-secondary btn-lg px-4"
                    th:href="@{/estoques}"
                  >
                    <i class="bi bi-x-circle me-2"></i>Cancelar
                  </a>
                  <button class="btn btn-secondary btn-lg px-5" type="submit">
                    <i class="bi bi-check-circle me-2" th:if="${!isEdit}"></i>
                    <i class="bi bi-arrow-repeat me-2" th:if="${isEdit}"></i>
                    <span th:text="${isEdit} ? 'Atualizar' : 'Criar'"></span>
                  </button>
                </div>
              </div>
            </div>
          </form>
        </div>
      </div>


      <div th:if="${erro}" class="alert alert-danger alert-modern mt-4">
        <i class="bi bi-exclamation-triangle-fill me-2"></i>
        <span th:text="${erro}"></span>
      </div>

      <style>
        .form-header {
          animation: slideInDown 0.6s ease-out;
        }

        .form-card,
        .info-card {
          border-radius: 20px !important;
          background: rgba(255, 255, 255, 0.95);
          backdrop-filter: blur(10px);
          animation: fadeInUp 0.8s ease-out;
        }

        .form-modern .form-floating {
          position: relative;
          margin-bottom: 1rem;
        }

        .form-control-modern {
          border: 2px solid #e9ecef;
          border-radius: 15px !important;
          font-size: 1rem;
          transition: all 0.3s ease;
          background: rgba(255, 255, 255, 0.9);
        }

        .form-control-modern:focus {
          border-color: #2c3e50;
          box-shadow: 0 0 0 0.25rem rgba(44, 62, 80, 0.15);
          background: white;
          transform: translateY(-2px);
        }

        .form-floating > label {
          color: #6c757d;
          font-weight: 500;
        }

        .form-floating > .form-control-modern:focus ~ label,
        .form-floating > .form-control-modern:not(:placeholder-shown) ~ label {
          color: #2c3e50;
          font-weight: 600;
        }

        .stat-item {
          padding: 20px;
          background: rgba(255, 255, 255, 0.8);
          border-radius: 15px;
          transition: all 0.3s ease;
          border: 1px solid rgba(52, 73, 94, 0.1);
        }

        .stat-item:hover {
          transform: translateY(-5px);
          box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .stat-icon {
          font-size: 2.5rem;
          margin-bottom: 10px;
        }

        .stat-number {
          font-size: 2rem;
          font-weight: 700;
          margin-bottom: 5px;
        }

        .stat-label {
          font-size: 0.9rem;
          color: #6c757d;
          font-weight: 500;
        }

        .progress-modern {
          background: rgba(108, 117, 125, 0.2);
          border-radius: 10px;
          overflow: hidden;
        }

        .progress-bar-modern {
          height: 100%;
          border-radius: 10px;
          transition: all 0.3s ease;
          position: relative;
          overflow: hidden;
        }

        .bg-success-gradient {
          background: linear-gradient(135deg, #28a745, #20c997);
        }

        .bg-warning-gradient {
          background: linear-gradient(135deg, #ffc107, #fd7e14);
        }

        .bg-danger-gradient {
          background: linear-gradient(135deg, #dc3545, #e83e8c);
        }

        .progress-bar-modern::after {
          content: "";
          position: absolute;
          top: 0;
          left: -100%;
          width: 100%;
          height: 100%;
          background: linear-gradient(
            90deg,
            transparent,
            rgba(255, 255, 255, 0.3),
            transparent
          );
          animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
          0% {
            left: -100%;
          }
          100% {
            left: 100%;
          }
        }

        .ferramenta-badge {
          font-size: 0.9rem;
          padding: 8px 12px;
          border-radius: 20px;
          transition: all 0.3s ease;
        }

        .ferramenta-badge:hover {
          transform: scale(1.05);
          background: linear-gradient(135deg, #2c3e50, #34495e) !important;
        }

        .btn-lg {
          border-radius: 25px;
          font-weight: 600;
          text-transform: uppercase;
          letter-spacing: 0.5px;
          transition: all 0.3s ease;
          position: relative;
          overflow: hidden;
        }

        .btn-lg::before {
          content: "";
          position: absolute;
          top: 0;
          left: -100%;
          width: 100%;
          height: 100%;
          background: linear-gradient(
            90deg,
            transparent,
            rgba(255, 255, 255, 0.2),
            transparent
          );
          transition: left 0.5s;
        }

        .btn-lg:hover::before {
          left: 100%;
        }

        .btn-lg:hover {
          transform: translateY(-2px);
          box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .alert-modern {
          border-radius: 15px;
          border: none;
          background: linear-gradient(135deg, #ff758c, #ff7eb3);
          color: white;
          font-weight: 500;
          animation: slideInUp 0.5s ease-out;
        }

        @keyframes slideInDown {
          from {
            opacity: 0;
            transform: translateY(-30px);
          }
          to {
            opacity: 1;
            transform: translateY(0);
          }
        }

        @keyframes fadeInUp {
          from {
            opacity: 0;
            transform: translateY(30px);
          }
          to {
            opacity: 1;
            transform: translateY(0);
          }
        }

        @keyframes slideInUp {
          from {
            opacity: 0;
            transform: translateY(20px);
          }
          to {
            opacity: 1;
            transform: translateY(0);
          }
        }

        /* Input Icons */
        .form-floating > label i {
          color: #2c3e50;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
          .card-body {
            padding: 2rem !important;
          }

          .d-flex.gap-3 {
            flex-direction: column;
          }

          .btn-lg {
            width: 100%;
          }

          .stat-item {
            margin-bottom: 1rem;
          }
        }
      </style>
    </div>
  </body>
</html>
